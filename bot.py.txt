from aiogram import Bot, Dispatcher, executor, types
import openpyxl
import os

API_TOKEN = os.getenv("BOT_TOKEN")  # Token–Ω–∏ Railway–¥–∞–Ω –æ–ª–∞–º–∏–∑

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

def load_products():
    workbook = openpyxl.load_workbook("products.xlsx")
    sheet = workbook.active
    products = []
    for row in sheet.iter_rows(min_row=2, values_only=True):
        name, price, stock = row
        products.append(f"{name} - {price} —Å—û–º (“õ–æ–ª–¥–∏“õ: {stock} –¥–æ–Ω–∞)")
    return "\n".join(products)

@dp.message_handler(commands=["start"])
async def start(message: types.Message):
    await message.answer("–°–∞–ª–æ–º! üõí –î—û–∫–æ–Ω–∏–º–∏–∑–≥–∞ —Ö—É—à –∫–µ–ª–∏–±—Å–∏–∑!\n–ú–µ–Ω—é —É—á—É–Ω /menu")

@dp.message_handler(commands=["menu"])
async def menu(message: types.Message):
    product_list = load_products()
    await message.answer(f"üìã –ú–µ–Ω—é:\n\n{product_list}")

if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)